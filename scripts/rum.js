var RUMSpeedIndex=function(a,b){a=a||window;var r,s,t,c=a.document,d=function(b){var d=!1;if(b.getBoundingClientRect){var e=b.getBoundingClientRect();d={top:Math.max(e.top,0),left:Math.max(e.left,0),bottom:Math.min(e.bottom,a.innerHeight||c.documentElement.clientHeight),right:Math.min(e.right,a.innerWidth||c.documentElement.clientWidth)};var f=d.bottom-d.top,g=d.right-d.left;if(0>=g||0>f)return!1;d.area=g*f}return d},e=function(b,c){var d=a.getComputedStyle(b).background,e=/url\((http.*)\)/gi;e.lastIndex=0;var f=e.exec(d);f&&f.length>1&&(c.url=f[1]),c.color=d.indexOf("rgb(")>-1,c.body="BODY"==b.tagName},f=function(a,b){a.children||(a.children=[]);var c=d(b);if(c){"IMG"==b.tagName?c.url=b.src:"IFRAME"==b.tagName?(c.tm=RUMSpeedIndex(b.contentWindow),c.iframe=!0):e(b,c),a.children.push(c);for(var g=0;g<b.children.length;++g)f(c,b.children[g])}},g=function(a){var b=0;if(a.children)for(var c=0;c<a.children.length;++c)b+=g(a.children[c]);a.area=Math.max(a.area-b,0);var d=b;return(a.color||a.url||a.body||a.iframe)&&(d+=a.area),d},h=function(a){if((a.color||a.url||a.body||a.iframe)&&o.push(a),a.children)for(var b=0;b<a.children.length;++b)h(a.children[b])},i=function(){var b={};f(b,a.document.body),g(b),h(b)},j=function(){for(var b={},c=a.performance.getEntriesByType("resource"),d=0;d<c.length;d++)b[c[d].name]=c[d].responseEnd;for(var e=0;e<o.length;e++)"tm"in o[e]||(o[e].tm=void 0!==b[o[e].url]?b[o[e].url]:0)},k=function(){var b=a.performance.getEntriesByType("resource");s=0;for(var c=0;c<b.length;c++){var d=b[c];-1!=d.name.indexOf(".woff")&&d.responseEnd>s&&(s=d.responseEnd)}},l=function(){if("msFirstPaint"in a.performance.timing&&(r=a.performance.timing.msFirstPaint-u),"chrome"in a&&"loadTimes"in a.chrome){var b=a.chrome.loadTimes();if("firstPaintTime"in b&&b.firstPaintTime>0){var d=b.startLoadTime;"requestTime"in b&&(d=b.requestTime),b.firstPaintTime>=d&&(r=1e3*(b.firstPaintTime-d))}}if(void 0===r||0>r||r>12e4){r=a.performance.timing.responseStart-u;for(var e={},f=c.getElementsByTagName("head")[0].children,g=0;g<f.length;g++){var h=f[g];"SCRIPT"==h.tagName&&h.src&&!h.async&&(e[h.src]=!0),"LINK"==h.tagName&&"stylesheet"==h.rel&&h.href&&(e[h.href]=!0)}for(var i=a.performance.getEntriesByType("resource"),j=!1,k=0;k<i.length;k++)if(j||!e[i[k].name]||"script"!=i[k].initiatorType&&"link"!=i[k].initiatorType)j=!0;else{var l=i[k].responseEnd;(void 0===r||l>r)&&(r=l)}}r=Math.max(r,0)},m=function(){for(var b={0:0},d=0,e=0;e<o.length;e++){var f=r*(1-q)+s*q;"tm"in o[e]&&o[e].tm>r&&(f=o[e].tm),void 0===b[f]&&(b[f]=0),b[f]+=o[e].area,d+=o[e].area}var g=Math.max(c.documentElement.clientWidth,a.innerWidth||0)*Math.max(c.documentElement.clientHeight,a.innerHeight||0);if(g!=d&&console.log("Number of pixels does not add up "+g+" != "+d),d){for(var h in b)b.hasOwnProperty(h)&&p.push({tm:h,area:b[h]});p.sort(function(a,b){return a.tm-b.tm});for(var i=0,j=0;j<p.length;j++)i+=p[j].area,p[j].progress=i/d}},n=function(){if(p.length){t=0;for(var a=0,b=0,c=0;c<p.length;c++){var d=p[c].tm-a;d>0&&1>b&&(t+=(1-b)*d),a=p[c].tm,b=p[c].progress}}else t=r},o=[],p=[],q=.25;try{var u=a.performance.timing.navigationStart;i(),j(),l(),k(),m(),n()}catch(v){}if(b){var w="";w+="Paint Rects\n";for(var x=0;x<o.length;x++)w+="area: "+o[x].area+", time: "+o[x].tm+", url: "+o[x].url+"\n";w+="Visual Progress\n";for(var x=0;x<p.length;x++)w+="area: "+p[x].area+", time: "+p[x].tm+", progress: "+p[x].progress+"\n";w+="First Paint: "+r+"\n",w+="Font time: "+s+"\n",w+="Speed Index: "+t+"\n",console.log(w)}return t};
window.onload = function() {
  var now = ruxitApi.now();
  var actionId = ruxitApi.enterAction('Speed Index of ' + window.location.pathname,'speedIndex',now - RUMSpeedIndex(), null);
  ruxitApi.leaveAction(actionId, now);
}
